<div class="notification-history-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">
        <i class="pi pi-bell"></i>
        Notification History
      </h1>
      <p class="page-subtitle">Manage and view all your notifications</p>
    </div>
    
    <div class="header-stats">
      <div class="stat-card">
        <div class="stat-value">{{ notifications.length }}</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat-card unread">
        <div class="stat-value">{{ getUnreadCount() }}</div>
        <div class="stat-label">Unread</div>
      </div>
      <div class="stat-card read">
        <div class="stat-value">{{ getReadCount() }}</div>
        <div class="stat-label">Read</div>
      </div>
      <div class="stat-card archived">
        <div class="stat-value">{{ getArchivedCount() }}</div>
        <div class="stat-label">Archived</div>
      </div>
    </div>
  </div>

  <!-- Filters Section -->
  <p-card class="filters-card">
    <div class="filters-container">
      <div class="filter-row">
        <div class="filter-group">
          <label for="searchText">Search</label>
          <input 
            id="searchText"
            type="text" 
            pInputText 
            [(ngModel)]="filterText" 
            (input)="onFilterChange()"
            placeholder="Search notifications..."
            class="filter-input"
          />
        </div>
        
        <div class="filter-group">
          <label for="typeFilter">Type</label>
          <p-dropdown 
            id="typeFilter"
            [options]="typeOptions" 
            [(ngModel)]="filterType"
            (onChange)="onFilterChange()"
            placeholder="Select type"
            [style]="{'width': '100%'}"
          ></p-dropdown>
        </div>
        
        <div class="filter-group">
          <label for="statusFilter">Status</label>
          <p-dropdown 
            id="statusFilter"
            [options]="statusOptions" 
            [(ngModel)]="filterStatus"
            (onChange)="onFilterChange()"
            placeholder="Select status"
            [style]="{'width': '100%'}"
          ></p-dropdown>
        </div>
        
        <div class="filter-actions">
          <button 
            pButton 
            type="button" 
            icon="pi pi-filter-slash" 
            label="Clear" 
            class="p-button-outlined p-button-secondary"
            (click)="clearFilters()"
          ></button>
          <button 
            pButton 
            type="button" 
            icon="pi pi-check-circle" 
            label="Mark All Read" 
            class="p-button-outlined p-button-success"
            (click)="markAllAsRead()"
            [disabled]="getUnreadCount() === 0"
          ></button>
        </div>
      </div>
    </div>
  </p-card>

  <!-- Notifications Table -->
  <p-card class="notifications-table-card">
    <p-table 
      [value]="filteredNotifications" 
      [loading]="loading"
      [paginator]="true" 
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} notifications"
      [rowsPerPageOptions]="[10, 25, 50]"
      styleClass="p-datatable-gridlines"
      [tableStyle]="{'min-width': '50rem'}"
    >
      <ng-template pTemplate="header">
        <tr>
          <th style="width: 40px;">Status</th>
          <th style="width: 80px;">Type</th>
          <th>Title</th>
          <th>Message</th>
          <th style="width: 150px;">Date</th>
          <th style="width: 120px;">Actions</th>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="body" let-notification>
                  <tr [class.unread-row]="isUnread(notification)">
          <td>
            <div class="status-indicator">
              <span 
                class="status-dot" 
                [class.read]="isRead(notification)"
                [class.unread]="isUnread(notification)"
                [class.archived]="isArchived(notification)"
              ></span>
            </div>
          </td>
          
          <td>
            <p-tag 
              [value]="mapNotificationType(notification.notificationType)" 
              [severity]="getTypeClass(notification.notificationType)"
              [icon]="getTypeIcon(notification.notificationType)"
            ></p-tag>
          </td>
          
          <td>
            <div class="notification-title">
              {{ notification.title }}
            </div>
          </td>
          
          <td>
            <div class="notification-message" [title]="notification.message">
              {{ notification.message }}
            </div>
          </td>
          
          <td>
            <div class="notification-date">
              {{ formatDate(notification.sentDate) }}
            </div>
          </td>
          
          <td>
            <div class="action-buttons">
              <button 
                pButton 
                type="button" 
                icon="pi pi-eye" 
                class="p-button-rounded p-button-text p-button-sm"
                pTooltip="Mark as read"
                (click)="markAsRead(notification)"
                [disabled]="isRead(notification)"
              ></button>
              
              <button 
                pButton 
                type="button" 
                icon="pi pi-external-link" 
                class="p-button-rounded p-button-text p-button-sm"
                pTooltip="Go to action"
                (click)="navigateToAction(notification)"
                [disabled]="!notification.relatedEntityType || !notification.relatedEntityId"
              ></button>
              
              <button 
                pButton 
                type="button" 
                icon="pi pi-inbox" 
                class="p-button-rounded p-button-text p-button-sm p-button-secondary"
                pTooltip="Archive notification"
                (click)="archiveNotification(notification)"
                [disabled]="isArchived(notification)"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
      
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="empty-message">
            <div class="empty-state">
              <i class="pi pi-bell-slash"></i>
              <h3>No notifications found</h3>
              <p>Try adjusting your filters or check back later for new notifications.</p>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>
</div>

<!-- Confirmation Dialog -->
<p-confirmDialog></p-confirmDialog> 