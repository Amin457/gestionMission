<div class="card p-4">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-semibold">Roles Management</h1>
    <button 
      pButton 
      icon="pi pi-plus" 
      label="New Role" 
      class="p-button p-button-primary p-button-sm"
      (click)="showAddEditDialog()">
    </button>
  </div>

  <p-table 
    [value]="roles" 
    [paginator]="false"
    [rows]="10"
    [scrollable]="true" 
    scrollHeight="600px"
    [loading]="loading"
    sortMode="multiple"
    styleClass="p-datatable-striped p-datatable-sm"
    responsiveLayout="scroll">
    <ng-template pTemplate="header">
      <tr class="bg-gray-100 text-sm text-gray-700">
        <th pSortableColumn="name">Name <p-sortIcon field="name"></p-sortIcon></th>
        <th pSortableColumn="code">Code <p-sortIcon field="code"></p-sortIcon></th>
        <th pSortableColumn="libelle">Label <p-sortIcon field="libelle"></p-sortIcon></th>
        <th style="width: 7rem"></th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-role>
      <tr class="text-sm hover:bg-gray-50">
        <td class="py-2 px-3">{{role.name}}</td>
        <td class="py-2 px-3">{{role.code}}</td>
        <td class="py-2 px-3">{{role.libelle}}</td>
        <td class="flex gap-2 justify-end">
          <button 
            pButton 
            icon="pi pi-pencil" 
            class="p-button-rounded p-button-text p-button-sm"
            (click)="showAddEditDialog(role)">
          </button>
          <button 
            pButton 
            icon="pi pi-trash" 
            class="p-button-rounded p-button-text p-button-sm p-button-danger"
            (click)="confirmDelete(role)">
          </button>
        </td>
      </tr>
    </ng-template>
  </p-table>

    <!-- Pagination -->
    <div>
      <p-paginator 
        [rows]="pageSize" 
        [totalRecords]="totalRecords" 
        [rowsPerPageOptions]="[5, 10, 25, 50]" 
        (onPageChange)="onPageChange($event)"
      ></p-paginator>
    </div>
  <p-toast></p-toast>
  <p-confirmDialog></p-confirmDialog>
</div>

<p-dialog 
  [(visible)]="displayDialog"
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [dismissableMask]="true"
  [breakpoints]="{'768px': '90vw'}"
  [style]="{width: '480px'}"
  styleClass="p-fluid rounded-xl shadow-xl"
  [header]="isEditing ? 'Edit Role' : 'Create Role'">

  <form [formGroup]="roleForm" (ngSubmit)="onSubmitRole()" class="space-y-4">
    <div>
      <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
      <input 
        pInputText 
        id="name" 
        formControlName="name"
        autofocus
        class="w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"
        [class.p-invalid]="roleForm.get('name')?.invalid && roleForm.get('name')?.touched" />
      <small class="p-error text-sm" *ngIf="getFieldError('name')">{{ getFieldError('name') }}</small>
    </div>
    <div>
      <label for="code" class="block text-sm font-medium text-gray-700 mb-1">Code</label>
      <input 
        pInputText 
        id="code" 
        formControlName="code"
        class="w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"
        [class.p-invalid]="roleForm.get('code')?.invalid && roleForm.get('code')?.touched" />
      <small class="p-error text-sm" *ngIf="getFieldError('code')">{{ getFieldError('code') }}</small>
    </div>
    <div>
      <label for="libelle" class="block text-sm font-medium text-gray-700 mb-1">Label</label>
      <input 
        pInputText 
        id="libelle" 
        formControlName="libelle"
        class="w-full p-2 border rounded-md focus:ring-2 focus:ring-indigo-500 focus:outline-none"
        [class.p-invalid]="roleForm.get('libelle')?.invalid && roleForm.get('libelle')?.touched" />
      <small class="p-error text-sm" *ngIf="getFieldError('libelle')">{{ getFieldError('libelle') }}</small>
    </div>

    <div class="flex justify-end gap-2 pt-4">
      <button 
        pButton 
        type="button"
        icon="pi pi-times" 
        label="Cancel" 
        class="bg-gray-100 text-gray-700 hover:bg-gray-200 px-3 py-2 rounded-md"
        (click)="displayDialog = false">
      </button>
      <button 
        pButton 
        type="submit"
        icon="pi pi-check" 
        label="Save" 
        class="bg-indigo-600 text-white hover:bg-indigo-700 px-3 py-2 rounded-md">
      </button>
    </div>
  </form>
</p-dialog>
